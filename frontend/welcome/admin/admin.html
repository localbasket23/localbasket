<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard - Local Basket</title>
  <link rel="icon" type="image/png" href="/welcome/logo2.png?v=99">
  <link rel="icon" type="image/png" sizes="32x32" href="/welcome/logo2.png?v=200">
  <link rel="icon" type="image/png" sizes="48x48" href="/welcome/logo2.png?v=200">
  <link rel="icon" type="image/png" sizes="96x96" href="/welcome/logo2.png?v=200">
  <link rel="apple-touch-icon" sizes="180x180" href="/welcome/logo2.png?v=200">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    :root {
      --lav: #ff8a1a;
      --lav-light: #ffb347;
      --lav-soft: rgba(255, 138, 26, 0.14);
      --bg: #f8f9fd;
      --white: #ffffff;
      --text: #2d3436;
      --text-light: #636e72;
      --border: #edf0f7;
      --radius: 16px;
      --shadow: 0 10px 30px rgba(0,0,0,0.05);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; font-family: "Poppins", sans-serif; }
    body { background: var(--bg); color: var(--text); overflow-x: hidden; }

    body.dark {
      --bg: #111827;
      --white: #1f2937;
      --text: #f3f4f6;
      --text-light: #9ca3af;
      --border: #334155;
      --lav-soft: rgba(255, 179, 71, 0.22);
      --shadow: 0 10px 30px rgba(0,0,0,0.35);
    }

    #sidebarOverlay {
      position: fixed; inset: 0; background: rgba(0,0,0,0.5);
      backdrop-filter: blur(4px); z-index: 1001; display: none; opacity: 0; transition: 0.3s;
    }
    #sidebarOverlay.show { display: block; opacity: 1; }

    .sidebar {
      width: 280px; height: 100vh; position: fixed; left: 0; top: 0;
      background: linear-gradient(160deg, var(--lav), var(--lav-light));
      color: white; padding: 30px 20px; z-index: 1002;
      transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 4px 0 20px rgba(0,0,0,0.1);
    }

    .brand { text-align: center; margin-bottom: 40px; }
    .brand img { width: 65px; margin-bottom: 10px; filter: drop-shadow(0 4px 8px rgba(0,0,0,0.2)); }
    .brand h2 { font-size: 20px; font-weight: 700; color: white; }

    .menu button {
      width: 100%; padding: 14px 18px; margin: 5px 0; border: none;
      border-radius: 12px; background: rgba(255,255,255,0.1);
      color: white; font-size: 14px; font-weight: 500; text-align: left;
      cursor: pointer; transition: 0.3s; display: flex; align-items: center; gap: 12px;
    }
    .menu button:hover, .menu button.active { background: white; color: var(--lav); transform: translateX(5px); }

    main { margin-left: 280px; padding: 0 30px 30px; padding-top: 18px; transition: 0.3s; }

    .topbar {
      background: var(--white); padding: 18px 22px; border-radius: var(--radius);
      display: flex; justify-content: space-between; align-items: center;
      box-shadow: var(--shadow); margin-bottom: 24px; border: 1px solid var(--border);
    }
    .topbar .title { font-size: 18px; font-weight: 700; color: var(--lav); display: flex; align-items: center; gap: 10px; }
    .menu-toggle { display: none; font-size: 24px; border: none; background: none; color: var(--lav); cursor: pointer; }

    .admin-controls { display: flex; align-items: center; gap: 12px; }
    .admin-profile { font-size: 14px; font-weight: 600; color: var(--text); }
    .theme-pill {
      display: flex; align-items: center; gap: 8px; padding: 7px 10px;
      background: var(--lav-soft); border-radius: 999px; color: var(--lav);
    }
    .switch { position: relative; display: inline-block; width: 42px; height: 24px; }
    .switch input { opacity: 0; width: 0; height: 0; }
    .slider { position: absolute; cursor: pointer; inset: 0; background: #cbd5e1; transition: .2s; border-radius: 24px; }
    .slider:before {
      position: absolute; content: ""; height: 18px; width: 18px; left: 3px; top: 3px;
      background: white; transition: .2s; border-radius: 50%;
    }
    .switch input:checked + .slider { background: var(--lav); }
    .switch input:checked + .slider:before { transform: translateX(18px); }

    .cards { display: grid; gap: 20px; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); }

    .card {
      background: var(--white); padding: 24px; border-radius: var(--radius);
      box-shadow: var(--shadow); border: 1px solid var(--border);
      transition: 0.3s; position: relative; overflow: hidden; cursor: pointer;
    }
    .card:hover { transform: translateY(-6px); border-color: var(--lav); }
    .card i { position: absolute; right: -10px; bottom: -10px; font-size: 80px; opacity: 0.07; color: var(--lav); }
    .card h3 { font-size: 13px; color: var(--text-light); text-transform: uppercase; letter-spacing: 1px; }
    .card .value { font-size: 30px; font-weight: 800; color: var(--lav); margin-top: 10px; }

    .recent-box {
      background: var(--white); margin-top: 24px; border-radius: var(--radius);
      padding: 24px; box-shadow: var(--shadow); border: 1px solid var(--border);
    }
    .recent-box h2 { font-size: 18px; margin-bottom: 20px; color: var(--text); }
    .log-item { display: flex; align-items: center; padding: 12px 0; border-bottom: 1px solid var(--border); font-size: 14px; }
    .log-item:last-child { border-bottom: none; }
    .log-icon { width: 35px; height: 35px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 15px; }

    .reports-wrap { margin-top: 28px; text-align: center; }
    .reports-btn {
      padding: 14px 26px; border: none; background: var(--lav); color: white; border-radius: 12px;
      font-weight: 600; cursor: pointer; box-shadow: 0 4px 15px rgba(106,60,255,0.3);
    }

    .hero {
      display: grid;
      grid-template-columns: 1.3fr 1fr;
      gap: 16px;
      margin-bottom: 18px;
    }
    .hero-card {
      background: linear-gradient(140deg, var(--lav), var(--lav-light));
      color: #fff;
      border-radius: var(--radius);
      padding: 22px;
      box-shadow: var(--shadow);
      border: 1px solid rgba(255,255,255,0.25);
    }
    .hero-card h1 { font-size: 22px; margin-bottom: 6px; }
    .hero-card p { font-size: 13px; opacity: .9; }
    .hero-card .hero-meta {
      margin-top: 14px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      border-radius: 999px;
      background: rgba(255,255,255,.16);
      font-size: 12px;
    }
    .hero-actions {
      background: var(--white);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 18px;
      box-shadow: var(--shadow);
      display: grid;
      gap: 10px;
      align-content: center;
    }
    .quick-btn {
      border: 1px solid var(--border);
      background: var(--white);
      color: var(--text);
      border-radius: 12px;
      padding: 11px 12px;
      text-align: left;
      font-weight: 600;
      cursor: pointer;
      transition: .2s;
    }
    .quick-btn:hover {
      border-color: var(--lav);
      color: var(--lav);
      background: var(--lav-soft);
    }

    .content-grid {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 16px;
      margin-top: 20px;
    }
    .panel {
      background: var(--white);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 20px;
    }
    .panel h3 {
      font-size: 16px;
      margin-bottom: 14px;
      color: var(--text);
    }
    .mini-list {
      display: grid;
      gap: 10px;
    }
    .mini-item {
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 10px 12px;
      font-size: 13px;
      color: var(--text-light);
      background: color-mix(in srgb, var(--white) 92%, var(--lav) 8%);
    }

    @media(max-width: 992px){
      .sidebar { transform: translateX(-100%); }
      .sidebar.open { transform: translateX(0); }
      main { margin-left: 0; padding: 0 18px 18px; padding-top: 0; }
      .menu-toggle { display: block; }
      .admin-profile { display: none; }
      .hero { grid-template-columns: 1fr; }
      .content-grid { grid-template-columns: 1fr; }
    }

    @media(max-width: 576px){
      .topbar { padding: 14px; }
      .topbar .title { font-size: 16px; }
      .cards { grid-template-columns: 1fr; gap: 14px; }
      .card { padding: 18px; }
      .card .value { font-size: 26px; }
      .recent-box { padding: 16px; }
      .reports-btn { width: 100%; }
      .hero-card h1 { font-size: 19px; }
      .hero-actions { padding: 14px; }
    }
  </style>

  <link rel='stylesheet' href='admin-shared.css'>
</head>

<body>

<div id="sidebarOverlay" onclick="toggleMenu()"></div>

<aside class="sidebar">
  <div class="brand">
    <img src="https://mylocalbasket.com/Images/mylocalbasketlogo.png" alt="Logo">
    <h2>Admin Panel</h2>
  </div>

  <div class="menu">
    <button class="active" onclick="location.href='admin.html'"><i class="fas fa-chart-pie"></i> Dashboard</button>
    <button onclick="location.href='admin-sellers.html'"><i class="fas fa-user-check"></i> Seller Verification</button>
    <button onclick="location.href='admin-products.html'"><i class="fas fa-box-open"></i> Product Approvals</button>
    <button onclick="location.href='admin-orders.html'"><i class="fas fa-shopping-cart"></i> Orders</button>
    <button onclick="location.href='admin-payments.html'"><i class="fas fa-wallet"></i> Payments</button>
    <button onclick="location.href='admin-settings.html'"><i class="fas fa-cog"></i> Settings</button>
    <button onclick="logout()" style="margin-top: 20px; background: rgba(255,71,87,0.2);"><i class="fas fa-sign-out-alt"></i> Logout</button>
  </div>
</aside>

<main>
  <div class="topbar lb-header">
    <div class="title lb-header-left">
      <button class="menu-toggle" onclick="toggleMenu()"><i class="fas fa-bars"></i></button>
      <span class="lb-header-title"><i class="fas fa-shield-alt"></i> Dashboard Overview</span>
    </div>

    <div class="admin-controls lb-header-right">
      <div class="admin-profile">Welcome back, Admin</div>
      <div class="theme-pill">
        <i class="fas fa-moon"></i>
        <label class="switch">
          <input type="checkbox" id="themeToggle">
          <span class="slider"></span>
        </label>
      </div>
    </div>
  </div>

  <section class="hero">
    <div class="hero-card">
      <h1>Control Center</h1>
      <p>Manage sellers, orders, payouts and quality checks from one place.</p>
      <div class="hero-meta" id="heroMeta">
        <i class="fas fa-calendar-day"></i>
        <span>Loading date...</span>
      </div>
    </div>

    <div class="hero-actions">
      <button class="quick-btn" onclick="location.href='admin-sellers.html'"><i class="fas fa-user-check"></i> Review Seller Requests</button>
      <button class="quick-btn" onclick="location.href='admin-orders.html'"><i class="fas fa-receipt"></i> Track Live Orders</button>
      <button class="quick-btn" onclick="location.href='admin-payments.html'"><i class="fas fa-wallet"></i> Check Pending Payouts</button>
    </div>
  </section>

  <div class="cards">
    <div class="card" onclick="location.href='admin-sellers.html'">
      <i class="fas fa-users"></i>
      <h3>Total Sellers</h3>
      <div class="value" id="totalSellers">0</div>
    </div>

    <div class="card" onclick="location.href='admin-seller-verification.html'">
      <i class="fas fa-clock"></i>
      <h3>Pending Verifications</h3>
      <div class="value" id="pendingVerifications" style="color: #ff9f43;">0</div>
    </div>

    <div class="card" onclick="location.href='admin-orders.html'">
      <i class="fas fa-receipt"></i>
      <h3>Total Orders</h3>
      <div class="value" id="totalOrders">0</div>
    </div>

    <div class="card" onclick="location.href='admin-reports.html'">
      <i class="fas fa-coins"></i>
      <h3>Total Revenue</h3>
      <div class="value" id="totalRevenue">Rs. 0</div>
    </div>
  </div>

  <div class="content-grid">
    <div class="recent-box" style="margin-top:0;">
      <h2><i class="fas fa-bell"></i> Recent Activities</h2>
      <div id="activityLog"></div>
    </div>

    <div class="panel">
      <h3><i class="fas fa-bolt"></i> Quick Insights</h3>
      <div class="mini-list">
        <div class="mini-item">Total Sellers: <b id="qiTotalSellers">0</b></div>
        <div class="mini-item">Pending Verifications: <b id="qiPendingVerifications">0</b></div>
        <div class="mini-item">Total Orders: <b id="qiTotalOrders">0</b></div>
        <div class="mini-item">Total Revenue: <b id="qiTotalRevenue">Rs. 0</b></div>
        <div class="mini-item">Last Updated: <b id="qiLastUpdated">--</b></div>
      </div>
      <div class="reports-wrap" style="margin-top:14px; text-align:left;">
        <button class="reports-btn" onclick="location.href='admin-reports.html'" style="width:100%;">
          <i class="fas fa-file-download"></i> Open Full Reports
        </button>
      </div>
    </div>
  </div>
</main>

<script>
const themeToggle = document.getElementById("themeToggle");

function initTheme() {
  const isDark = localStorage.getItem("theme") === "dark";
  document.body.classList.toggle("dark", isDark);
  if (themeToggle) themeToggle.checked = isDark;
}

if (themeToggle) {
  themeToggle.addEventListener("change", () => {
    const isDark = themeToggle.checked;
    document.body.classList.toggle("dark", isDark);
    localStorage.setItem("theme", isDark ? "dark" : "light");
  });
}

function toggleMenu(){
  const sidebar = document.querySelector(".sidebar");
  const overlay = document.getElementById("sidebarOverlay");
  sidebar.classList.toggle("open");
  const isOpen = sidebar.classList.contains("open");
  overlay.classList.toggle("show", isOpen);
  document.body.style.overflow = isOpen ? "hidden" : "auto";
}

async function loadDashboard() {
  const API_BASE = "http://localhost:5000/api/admin";

  try {
    const res = await fetch(`${API_BASE}/dashboard`);
    const data = await res.json();

    if (data.success) {
      animateValue("totalSellers", 0, data.stats.totalSellers || 0, 1000);
      animateValue("pendingVerifications", 0, data.stats.pendingVerifications || 0, 1000);
      animateValue("totalOrders", 0, data.stats.totalOrders || 0, 1000);

      const revenue = data.stats.totalRevenue || 0;
      document.getElementById("totalRevenue").innerText = "Rs. " + Number(revenue).toLocaleString("en-IN");

      renderActivities(data.recentActivities);
      updateQuickInsights(data.stats);
    }
  } catch (err) {
    console.error("Dashboard Load Error:", err);
    setFallbackData();
  }
}

function renderActivities(list) {
  const box = document.getElementById("activityLog");
  box.innerHTML = "";

  if (!list || list.length === 0) {
    box.innerHTML = "<div class='log-item'>No recent activity</div>";
    return;
  }

  list.slice(0, 8).forEach(item => {
    let icon, color, bg;

    switch(item.type) {
      case "seller":
        icon = "fa-user-plus"; color = "#2ecc71"; bg = "#e8f5e9";
        break;
      case "order":
        icon = "fa-shopping-bag"; color = "#3498db"; bg = "#e3f2fd";
        break;
      case "payment":
        icon = "fa-wallet"; color = "#f1c40f"; bg = "#fff9c4";
        break;
      default:
        icon = "fa-bell"; color = "#9b59b6"; bg = "#f3e5f5";
    }

    const div = document.createElement("div");
    div.className = "log-item";
    div.innerHTML = `
      <div class="log-icon" style="background:${bg}; color:${color}">
        <i class="fas ${icon}"></i>
      </div>
      <div>${item.message} <br> <small style="color:#999; font-size:11px">${item.time || "just now"}</small></div>
    `;
    box.appendChild(div);
  });
}

function animateValue(id, start, end, duration) {
  const obj = document.getElementById(id);
  if (!obj) return;

  let startTimestamp = null;
  const step = (timestamp) => {
    if (!startTimestamp) startTimestamp = timestamp;
    const progress = Math.min((timestamp - startTimestamp) / duration, 1);
    obj.innerHTML = Math.floor(progress * (end - start) + start).toLocaleString();
    if (progress < 1) window.requestAnimationFrame(step);
  };
  window.requestAnimationFrame(step);
}

function setFallbackData() {
  animateValue("totalSellers", 0, 0, 600);
  animateValue("pendingVerifications", 0, 0, 600);
  animateValue("totalOrders", 0, 0, 600);
  document.getElementById("totalRevenue").innerText = "Rs. 0";

  renderActivities([]);

  updateQuickInsights({
    totalSellers: 0,
    pendingVerifications: 0,
    totalOrders: 0,
    totalRevenue: 0
  });
}

function logout(){
  if(confirm("Are you sure you want to logout?")){
    localStorage.clear();
    location.href = "login.html";
  }
}

function setHeroMetaDate() {
  const el = document.getElementById("heroMeta");
  if (!el) return;
  const date = new Date().toLocaleDateString("en-IN", { weekday: "short", day: "2-digit", month: "short", year: "numeric" });
  el.innerHTML = `<i class="fas fa-calendar-day"></i><span>${date}</span>`;
}

function updateQuickInsights(stats = {}) {
  const safe = (v) => (v == null ? 0 : v);
  const totalSellers = safe(stats.totalSellers);
  const pendingVerifications = safe(stats.pendingVerifications);
  const totalOrders = safe(stats.totalOrders);
  const totalRevenue = safe(stats.totalRevenue);

  const set = (id, val) => {
    const el = document.getElementById(id);
    if (el) el.innerText = val;
  };

  set("qiTotalSellers", Number(totalSellers).toLocaleString());
  set("qiPendingVerifications", Number(pendingVerifications).toLocaleString());
  set("qiTotalOrders", Number(totalOrders).toLocaleString());
  set("qiTotalRevenue", "Rs. " + Number(totalRevenue).toLocaleString("en-IN"));
  set("qiLastUpdated", new Date().toLocaleTimeString("en-IN", { hour: "2-digit", minute: "2-digit" }));
}

window.onload = () => {
  initTheme();
  setHeroMetaDate();
  loadDashboard();
};
</script>


<script src='admin-layout.js'></script>
</body>
</html>



