<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Orders | Local Basket</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <link rel="icon" type="image/png" href="/welcome/logo2.png?v=99">
  <link rel="icon" type="image/png" sizes="32x32" href="/welcome/logo2.png?v=200">
  <link rel="icon" type="image/png" sizes="48x48" href="/welcome/logo2.png?v=200">
  <link rel="icon" type="image/png" sizes="96x96" href="/welcome/logo2.png?v=200">
  <link rel="apple-touch-icon" sizes="180x180" href="/welcome/logo2.png?v=200">

  <style>
    :root {
      --lav: #ff8a1a;
      --lav-light: #ffb347;
      --lav-soft: rgba(255, 138, 26, 0.14);
      --bg: #f8f9fd;
      --white: #fff;
      --text: #2d3436;
      --text-light: #636e72;
      --border: #edf0f7;
      --radius: 16px;
      --shadow: 0 10px 30px rgba(0,0,0,0.05);
      --surface: #ffffff;
      --surface-2: #fafbff;
      --table-head: #f4f6fb;
      --row-hover: #fafaff;
      --muted: #9aa2b1;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; font-family: "Poppins", sans-serif; }
    body { background: var(--bg); color: var(--text); overflow-x: hidden; }

    body.dark {
      --bg: #111827;
      --white: #1f2937;
      --text: #f3f4f6;
      --text-light: #9ca3af;
      --border: #334155;
      --lav-soft: rgba(255, 179, 71, 0.22);
      --shadow: 0 10px 30px rgba(0,0,0,0.35);
      --surface: #111827;
      --surface-2: #0b1220;
      --table-head: #0b1220;
      --row-hover: #111b2d;
      --muted: #94a3b8;
    }

    #sidebarOverlay {
      position: fixed; inset: 0; background: rgba(0,0,0,0.5);
      backdrop-filter: blur(4px); z-index: 1001; display: none; opacity: 0; transition: 0.3s;
    }
    #sidebarOverlay.show { display: block; opacity: 1; }

    .sidebar {
      width: 280px; height: 100vh; position: fixed; left: 0; top: 0;
      background: linear-gradient(160deg, var(--lav), var(--lav-light));
      color: white; padding: 30px 20px; z-index: 1002;
      transition: transform 0.35s ease;
      box-shadow: 4px 0 20px rgba(0,0,0,0.1);
    }

    .close-sidebar {
      display: none; position: absolute; right: 20px; top: 20px;
      font-size: 22px; color: white; cursor: pointer;
      width: 35px; height: 35px; background: rgba(255,255,255,0.12);
      border-radius: 50%; align-items: center; justify-content: center;
    }

    .brand { text-align: center; margin-bottom: 40px; }
    .brand img { width: 65px; margin-bottom: 10px; filter: drop-shadow(0 4px 8px rgba(0,0,0,0.2)); }
    .brand h2 { font-size: 20px; font-weight: 700; color: white; }

    .menu button {
      width: 100%; padding: 14px 18px; margin: 5px 0; border: none;
      border-radius: 12px; background: rgba(255,255,255,0.1);
      color: white; font-size: 14px; font-weight: 500; text-align: left;
      cursor: pointer; transition: 0.3s; display: flex; align-items: center; gap: 12px;
    }
    .menu button:hover, .menu button.active { background: white; color: var(--lav); transform: translateX(5px); }

    main { margin-left: 260px; padding: 24px; transition: 0.3s; min-height: 100vh; }

    .top-nav {
      display: flex; align-items: center; justify-content: space-between;
      background: var(--white); padding: 15px 18px; border-radius: var(--radius);
      box-shadow: var(--shadow); margin-bottom: 18px; border: 1px solid var(--border);
      gap: 12px;
    }
    .menu-toggle {
      display: none; font-size: 20px; background: var(--lav-soft);
      color: var(--lav); border: none; width: 40px; height: 40px;
      border-radius: 10px; cursor: pointer;
    }

    .header-title h2 { color: var(--lav); font-size: 22px; }
    .header-title p { font-size: 13px; color: var(--text-light); }

    .nav-tools { display: flex; align-items: center; gap: 10px; }
    .theme-pill {
      display: flex; align-items: center; gap: 8px; padding: 7px 10px;
      background: var(--lav-soft); border-radius: 999px; color: var(--lav);
    }
    .switch { position: relative; display: inline-block; width: 42px; height: 24px; }
    .switch input { opacity: 0; width: 0; height: 0; }
    .slider { position: absolute; cursor: pointer; inset: 0; background: #cbd5e1; transition: .2s; border-radius: 24px; }
    .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 3px; top: 3px; background: white; transition: .2s; border-radius: 50%; }
    .switch input:checked + .slider { background: var(--lav); }
    .switch input:checked + .slider:before { transform: translateX(18px); }

    .hero {
      display: grid;
      grid-template-columns: 1.2fr 1fr;
      gap: 16px;
      margin-bottom: 18px;
    }
    .hero-card {
      background: linear-gradient(140deg, var(--lav), var(--lav-light));
      color: #fff;
      border-radius: var(--radius);
      padding: 20px;
      box-shadow: var(--shadow);
    }
    .hero-card h2 { font-size: 22px; margin-bottom: 6px; }
    .hero-card p { font-size: 13px; opacity: .9; }
    .hero-meta {
      margin-top: 12px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 7px 12px;
      border-radius: 999px;
      background: rgba(255,255,255,.16);
      font-size: 12px;
    }

    .stat-panel {
      background: var(--white);
      border-radius: var(--radius);
      border: 1px solid var(--border);
      box-shadow: var(--shadow);
      padding: 16px;
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      align-content: center;
    }
    .stat-tile {
      border: 1px solid var(--border);
      background: var(--surface-2);
      border-radius: 12px;
      padding: 10px;
    }
    .stat-tile small { color: var(--text-light); font-size: 11px; text-transform: uppercase; }
    .stat-tile b { display: block; margin-top: 4px; color: var(--lav); font-size: 18px; }

    .search-container {
      background: var(--white); padding: 15px; border-radius: var(--radius);
      margin-bottom: 18px; box-shadow: var(--shadow); display: flex; align-items: center; gap: 12px;
      border: 1px solid var(--border);
    }
    .search-container i { color: var(--lav); }
    .search-container input { flex: 1; border: none; outline: none; font-size: 14px; color: var(--text); background: transparent; }
    .search-container input::placeholder { color: var(--muted); }

    .filter-bar {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
      margin-bottom: 18px;
    }
    .filter-pill {
      background: var(--lav-soft);
      color: var(--lav);
      border-radius: 999px;
      padding: 8px 12px;
      font-size: 12px;
      font-weight: 600;
      border: 1px solid var(--border);
    }

    .table-card {
      background: var(--white); border-radius: var(--radius); overflow: hidden;
      box-shadow: var(--shadow); border: 1px solid var(--border);
    }
    table { width: 100%; border-collapse: collapse; }
    th {
      background: var(--table-head);
      padding: 15px 20px; text-align: left; font-size: 12px;
      text-transform: uppercase; color: var(--text-light); border-bottom: 1px solid var(--border);
    }
    td { padding: 15px 20px; border-bottom: 1px solid var(--border); font-size: 14px; }
    tr:hover { background: var(--row-hover); }

    .status {
      padding: 4px 12px; border-radius: 20px; font-size: 11px;
      font-weight: 700; text-transform: uppercase; display: inline-block;
    }
    .st-DELIVERED { background: #e8f5e9; color: #2ecc71; }
    .st-PLACED { background: #fff8e1; color: #ffa000; }
    .st-CONFIRMED { background: #e3f2fd; color: #3498db; }
    .st-REJECTED { background: #ffebee; color: #e74c3c; }
    .st-CANCELLED { background: #fde2e2; color: #c0392b; }
    .st-OUT_FOR_DELIVERY { background: #ede9fe; color: #6d28d9; }

    .btn-view {
      background: var(--lav-soft); color: var(--lav); border: none;
      padding: 8px 16px; border-radius: 8px; cursor: pointer;
      font-weight: 600; font-size: 13px; transition: 0.2s;
    }
    .btn-view:hover { background: var(--lav); color: white; }

    .modal-overlay {
      position: fixed; inset: 0; background: rgba(0,0,0,0.5);
      backdrop-filter: blur(4px); display: none; justify-content: center;
      align-items: center; z-index: 2000;
    }
    .modal-card {
      background: var(--white); width: 500px; padding: 30px; border-radius: 20px;
      box-shadow: 0 20px 50px rgba(0,0,0,0.2); position: relative; border: 1px solid var(--border);
    }
    .detail-row { display: flex; justify-content: space-between; gap: 12px; padding: 10px 0; border-bottom: 1px dashed var(--border); }
    .detail-row span:first-child { color: var(--text-light); font-size: 13px; }
    .detail-row span:last-child { font-weight: 600; text-align: right; }

    #mobileSlider {
      position: fixed; bottom: 0; left: 0; right: 0; background: var(--white);
      z-index: 2100; padding: 25px; border-radius: 25px 25px 0 0;
      transform: translateY(100%); transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 -10px 30px rgba(0,0,0,0.1);
      border-top: 1px solid var(--border);
    }
    #mobileSlider.active { transform: translateY(0); }

    .mobile-list { display: none; }
    .order-card {
      background: var(--white); border-radius: 16px; padding: 18px;
      margin-bottom: 12px; box-shadow: var(--shadow); border: 1px solid var(--border);
    }
    .order-meta {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      margin-top: 10px;
      font-size: 12px;
      color: var(--text-light);
    }
    .order-row {
      display: flex;
      justify-content: space-between;
      gap: 10px;
      font-size: 12px;
      padding: 8px 10px;
      border: 1px solid var(--border);
      border-radius: 10px;
      background: var(--surface-2);
      margin-top: 10px;
    }

    @media (max-width: 992px) {
      main { margin-left: 0; padding: 18px; }
      .sidebar { transform: translateX(-100%); width: 280px; }
      .sidebar.open { transform: translateX(0); }
      .menu-toggle, .close-sidebar { display: flex; }
      .table-card { display: none; }
      .mobile-list { display: block; }
      .hero { grid-template-columns: 1fr; }
    }

    @media (max-width: 576px) {
      .top-nav { padding: 12px; }
      .header-title h2 { font-size: 18px; }
      .header-title p { font-size: 12px; }
      .nav-tools { gap: 6px; }
      #mobileSlider { padding: 18px; }
    }
  </style>

  <link rel='stylesheet' href='admin-shared.css'>
</head>

<body>

<div id="sidebarOverlay" onclick="toggleSidebar()"></div>

<aside class="sidebar" id="sidebar">
  <div class="brand">
    <div class="close-sidebar" onclick="toggleSidebar()"><i class="fas fa-times"></i></div>
    <img src="https://mylocalbasket.com/Images/mylocalbasketlogo.png" alt="Logo">
    <h2>Admin Panel</h2>
  </div>
  <div class="menu">
    <button onclick="location.href='admin.html'"><i class="fas fa-chart-pie"></i> Dashboard</button>
    <button onclick="location.href='admin-sellers.html'"><i class="fas fa-user-check"></i> Seller Verification</button>
    <button onclick="location.href='admin-products.html'"><i class="fas fa-box-open"></i> Products</button>
    <button class="active" onclick="location.href='admin-orders.html'"><i class="fas fa-shopping-cart"></i> Orders</button>
    <button onclick="location.href='admin-payments.html'"><i class="fas fa-wallet"></i> Payments</button>
    <button onclick="location.href='admin-settings.html'"><i class="fas fa-cog"></i> Settings</button>
    <button onclick="logout()" style="margin-top:20px; background: rgba(255,71,87,0.2);"><i class="fas fa-sign-out-alt"></i> Logout</button>
  </div>
</aside>

<main>
  <div class="top-nav topbar lb-header">
    <div class="lb-header-left">
      <button class="menu-toggle" onclick="toggleSidebar()"><i class="fas fa-bars"></i></button>
      <div class="header-title">
        <h2 class="lb-header-title">Orders Management</h2>
        <p class="lb-header-sub" id="countText">Loading data...</p>
      </div>
    </div>
    <div class="nav-tools lb-header-right">
      <div class="theme-pill">
        <i class="fas fa-moon"></i>
        <label class="switch">
          <input type="checkbox" id="themeToggle">
          <span class="slider"></span>
        </label>
      </div>
    </div>
  </div>

  <section class="hero">
    <div class="hero-card">
      <h2>Order Command Center</h2>
      <p>Track, verify, and resolve orders with fast actions and clean status visibility.</p>
      <div class="hero-meta"><i class="fas fa-bolt"></i> Live Queue Monitoring</div>
    </div>
    <div class="stat-panel">
      <div class="stat-tile"><small>Total</small><b id="statTotal">0</b></div>
      <div class="stat-tile"><small>Pending</small><b id="statPending">0</b></div>
      <div class="stat-tile"><small>Delivered</small><b id="statDelivered">0</b></div>
      <div class="stat-tile"><small>Revenue</small><b id="statRevenue">Rs. 0</b></div>
    </div>
  </section>

  <div class="search-container">
    <i class="fas fa-search"></i>
    <input id="searchInput" placeholder="Search by Order ID, customer, or store...">
  </div>

  <div class="filter-bar">
    <div class="filter-pill"><i class="fas fa-filter"></i> All Status</div>
    <div class="filter-pill"><i class="fas fa-clock"></i> Latest First</div>
  </div>

  <div class="table-card">
    <table>
      <thead>
        <tr>
          <th>Order ID</th>
          <th>Customer</th>
          <th>Store Name</th>
          <th>Total</th>
          <th>Method</th>
          <th>Status</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="ordersBody"></tbody>
    </table>
  </div>

  <div class="mobile-list" id="mobileList"></div>
</main>

<div class="modal-overlay" id="modalOverlay" onclick="closeDetail()">
  <div class="modal-card" onclick="event.stopPropagation()">
    <div style="display:flex; justify-content:space-between; margin-bottom:20px; align-items:center;">
      <h3 style="color:var(--lav)">Order Details</h3>
      <button class="btn-view" style="padding:5px 10px" onclick="closeDetail()">X</button>
    </div>
    <div id="modalContent"></div>
  </div>
</div>

<div id="mobileSlider">
  <div style="width:40px; height:5px; background:#ddd; border-radius:10px; margin:0 auto 20px;"></div>
  <h3 style="margin-bottom:20px; color: var(--lav);">Order Details</h3>
  <div id="sliderContent"></div>
  <button class="btn-view" style="width:100%; margin-top:20px; padding:14px;" onclick="closeDetail()">Close</button>
</div>

<script>
const BASE = "http://localhost:5000/api/admin";
let allOrders = [];
const themeToggle = document.getElementById("themeToggle");

function initTheme() {
  const isDark = localStorage.getItem("theme") === "dark";
  document.body.classList.toggle("dark", isDark);
  if (themeToggle) themeToggle.checked = isDark;
}

if (themeToggle) {
  themeToggle.addEventListener("change", () => {
    const isDark = themeToggle.checked;
    document.body.classList.toggle("dark", isDark);
    localStorage.setItem("theme", isDark ? "dark" : "light");
  });
}

function toggleSidebar() {
  const sb = document.getElementById("sidebar");
  const overlay = document.getElementById("sidebarOverlay");
  sb.classList.toggle("open");
  const isOpen = sb.classList.contains("open");
  overlay.classList.toggle("show", isOpen);
  document.body.style.overflow = isOpen ? "hidden" : "auto";
}

async function loadOrders() {
  try {
    const res = await fetch(`${BASE}/orders`);
    const data = await res.json();
    allOrders = data.orders || [];
    setStats(allOrders);
    document.getElementById("countText").innerText = `Total: ${allOrders.length} orders found`;
    render(allOrders);
  } catch (e) {
    document.getElementById("countText").innerText = "Connection Error";
  }
}

function setStats(list = []) {
  const total = list.length;
  const pending = list.filter(o => String(o.status || "").toUpperCase() === "PLACED").length;
  const delivered = list.filter(o => String(o.status || "").toUpperCase() === "DELIVERED").length;
  const revenue = list.reduce((sum, o) => sum + Number(o.total_amount || 0), 0);
  document.getElementById("statTotal").innerText = total;
  document.getElementById("statPending").innerText = pending;
  document.getElementById("statDelivered").innerText = delivered;
  document.getElementById("statRevenue").innerText = `Rs. ${revenue.toLocaleString("en-IN")}`;
}

function render(orders) {
  const tbody = document.getElementById("ordersBody");
  const mList = document.getElementById("mobileList");
  tbody.innerHTML = "";
  mList.innerHTML = "";

  orders.forEach(o => {
    const oid = o.id || o.order_id;
    const status = String(o.status || "PLACED").toUpperCase();
    tbody.innerHTML += `
      <tr>
        <td style="font-weight:700; color:var(--lav)">#${oid}</td>
        <td>${o.customer_name || "N/A"}</td>
        <td>${o.store_name || "N/A"}</td>
        <td style="font-weight:700">Rs. ${o.total_amount || 0}</td>
        <td><small>${o.payment_method || "N/A"}</small></td>
        <td><span class="status st-${status}">${status}</span></td>
        <td><button class="btn-view" onclick="openDetail(${oid})">View</button></td>
      </tr>
    `;

    mList.innerHTML += `
      <div class="order-card" onclick="openDetail(${oid})">
        <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
          <span style="font-weight:700; color:var(--lav)">#${oid}</span>
          <span class="status st-${status}">${status}</span>
        </div>
        <div style="font-size:15px; font-weight:600;">${o.customer_name || "N/A"}</div>
        <div class="order-meta">
          <span>Store: ${o.store_name || "N/A"}</span>
          <span>Pay: ${o.payment_method || "N/A"}</span>
        </div>
        <div class="order-row">
          <span>Total</span>
          <span style="font-weight:700">Rs. ${o.total_amount || 0}</span>
        </div>
      </div>
    `;
  });
}

searchInput.addEventListener("input", (e) => {
  const val = e.target.value.toLowerCase();
  const filtered = allOrders.filter(o => {
    const oid = o.id || o.order_id || "";
    return String(oid).includes(val)
      || String(o.customer_name || "").toLowerCase().includes(val)
      || String(o.store_name || "").toLowerCase().includes(val);
  });
  setStats(filtered);
  render(filtered);
});

async function openDetail(id) {
  const res = await fetch(`${BASE}/orders/${id}`);
  const data = await res.json();
  const o = data.order || {};

  const html = `
    <div class="detail-row"><span>Order ID</span><span>#${o.order_id || id}</span></div>
    <div class="detail-row"><span>Customer</span><span>${o.customer_name || "N/A"}</span></div>
    <div class="detail-row"><span>Phone</span><span>${o.customer_phone || "N/A"}</span></div>
    <div class="detail-row"><span>Address</span><span>${o.customer_address || "N/A"}</span></div>
    <div style="margin:15px 0; border-top: 1px solid var(--border);"></div>
    <div class="detail-row"><span>Store</span><span>${o.store_name || "N/A"}</span></div>
    <div class="detail-row"><span>Owner</span><span>${o.owner_name || "N/A"}</span></div>
    <div class="detail-row"><span>Seller Phone</span><span>${o.seller_phone || "N/A"}</span></div>
  `;

  if (window.innerWidth > 992) {
    document.getElementById("modalContent").innerHTML = html;
    document.getElementById("modalOverlay").style.display = "flex";
  } else {
    document.getElementById("sliderContent").innerHTML = html;
    document.getElementById("mobileSlider").classList.add("active");
  }
}

function closeDetail() {
  document.getElementById("modalOverlay").style.display = "none";
  document.getElementById("mobileSlider").classList.remove("active");
}

function logout() {
  if (confirm("Logout from Panel?")) window.location.href = "index.html";
}

window.onload = () => {
  initTheme();
  loadOrders();
};
</script>


<script src='admin-layout.js'></script>
</body>
</html>



